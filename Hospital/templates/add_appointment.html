{% extends 'navigationBar.html' %}
{% block body %}

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
  background: linear-gradient(180deg, #031216, #092c31, #013133);
  color: #fff;
  font-family: 'Poppins', sans-serif;
}

.container {
  max-width: 650px;
  margin: 60px auto;
  background: rgba(255,255,255,0.07);
  backdrop-filter: blur(10px);
  padding: 40px 50px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,255,209,0.2);
}

h2 {
  text-align: center;
  color: #00e6c0;
  font-weight: 700;
  margin-bottom: 25px;
}

label {
  font-weight: 600;
  margin-top: 10px;
  display: block;
}

select, input {
  width: 100%;
  background: rgba(255,255,255,0.1);
  border: none;
  border-radius: 10px;
  color: #000;
  padding: 10px 15px;
  margin-top: 8px;
  margin-bottom: 15px;
}

.btn {
  background: linear-gradient(90deg, #00ffd1, #007b83);
  border: none;
  border-radius: 10px;
  padding: 12px;
  width: 100%;
  color: white;
  font-weight: 700;
  transition: 0.3s;
}
.btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px rgba(0,255,209,0.4);
}
</style>

<div class="container">
  <h2>‚ûï Add Appointment</h2>

  <form method="POST">
    {% csrf_token %}

    <label>üë®‚Äç‚öïÔ∏è Doctor</label>
    <select name="D_name" id="doctorSelect" required>
      <option value="">Select Doctor</option>
      {% for i in doctors %}
      <option value="{{ i.id }}">{{ i.name }} ({{ i.Special }})</option>
      {% endfor %}
    </select>

    <div id="scheduleInfo" style="font-weight:600; margin-bottom:10px;"></div>

    <label>üßç‚Äç‚ôÇÔ∏è Patient Name</label>
<input type="text" name="P_name" placeholder="Enter patient name" required>

    <label>üìÖ Date</label>
    <input type="date" name="date" required>

    <label>‚è∞ Time</label>
    <select name="time" id="timeSelect" disabled required>
      <option value="">Select Time</option>
    </select>

    <button type="submit" id="submitBtn" class="btn" disabled>üíæ Save Appointment</button>
  </form>
</div>


<script>
function loadSchedule() {
    let doctorId = document.getElementById("doctorSelect").value;
    let dateValue = document.querySelector("input[name='date']").value;

    if (!doctorId || !dateValue) return;  // Wait until both selected

    fetch(`/get-doctor-schedule/${doctorId}/${dateValue}/`)
    .then(response => response.json())
    .then(data => {

        let scheduleInfo = document.getElementById("scheduleInfo");
        let timeSelect = document.getElementById("timeSelect");
        let submitBtn = document.getElementById("submitBtn");

        timeSelect.innerHTML = ""; // clear old times

        if (data.status == "no_schedule") {
            scheduleInfo.innerHTML = "<span style='color:red;'>No schedule available for this date.</span>";
            timeSelect.disabled = true;
            submitBtn.disabled = true;
            return;
        }

        scheduleInfo.innerHTML = `<span style='color:#00e6c0;'>Available Time: ${data.start_time} to ${data.end_time}</span>`;
        timeSelect.disabled = false;
        submitBtn.disabled = false;

        data.slots.forEach(slot => {
            let option = document.createElement("option");
            option.value = slot;
            option.textContent = slot;
            timeSelect.appendChild(option);
        });

    });
}

document.getElementById("doctorSelect").addEventListener("change", loadSchedule);
document.querySelector("input[name='date']").addEventListener("change", loadSchedule);
</script>


{% endblock %}
